# Kpop Challenge Bot

## Режим "Правда или ложь"

Игра использует внешний сервис `kpop-facts-api.vercel.app` для получения
случайных фактов о K-pop. Запросы к API автоматически ограничиваются одной в
секунду, а при ошибках бот сообщает пользователю о проблеме.

## Режим ИИ

Пункт **«Угадай группу (ИИ)»** теперь использует заранее подготовленный
список из 25 k-pop групп. Список хранится в файле `top50_groups.json`,
поэтому дополнительно генерировать его через OpenAI больше не нужно.

Чтобы изменить или расширить список, отредактируйте `top50_groups.json` в
формате:

```json
{
  "groups": [
    {"name": "BTS", "members": ["Jin", "Suga", ...]},
    ...
  ]
}
```

При наличии файла режим ИИ автоматически доступен в меню бота.

## Режим "Угадай по фото"
Игра использует фотографии айдолов, синхронизированные из Dropbox.
Перед запуском нужно подготовить локальную папку с изображениями:

1. Получите параметры приложения: `app key`, `app secret` и `refresh token`
   (через стандартный OAuth‑flow с `offline access`). Задайте их в переменных
   окружения `DROPBOX_APP_KEY`, `DROPBOX_APP_SECRET` и
   `DROPBOX_REFRESH_TOKEN`.
2. (Опционально) укажите путь к папке в Dropbox через `DROPBOX_REMOTE_PATH`
   (по умолчанию `/kpop_images`).
3. (Опционально) укажите путь к локальной папке через переменную
   `DROPBOX_ROOT` (по умолчанию `./dropbox_sync`).
4. Запустите `python sync_dropbox.py`, чтобы синхронизировать содержимое
   каталога из Dropbox с локальной папкой. Скрипт скачивает только новые
   или изменённые файлы и удаляет те, что были убраны из Dropbox. Он
   использует `refresh token` и автоматически обновляет `access token`.
   Скрипт можно запускать вручную или доверить файлу `start.sh`, который
   сначала выполняет синхронизацию, а затем стартует `app.py`.


Файлы используются только для отправки в Telegram и не сохраняются
навсегда.

Требования:

- на сервере должен быть доступ в интернет для синхронизации с Dropbox;
- в базе групп (файл `top50_groups.json` и встроенный список) должно
  находиться не менее 20 участников, для которых есть фотографии.

Если нужное изображение отсутствует, бот пропустит айдола и попытается
подобрать другого.
